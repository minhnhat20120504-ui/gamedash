<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Geometry Dash HTML</title>

<style>
html,body{
  margin:0;
  padding:0;
  overflow:hidden;
  background:#000;
  touch-action:none;
}
canvas{display:block}
#ui{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  color:#fff;
  font-size:18px;
  text-shadow:0 0 10px #0ff;
}
#hint{
  position:fixed;
  bottom:15px;
  left:50%;
  transform:translateX(-50%);
  color:#aaa;
  font-size:12px;
}
</style>
</head>

<body>
<canvas id="c"></canvas>
<div id="ui">0%</div>
<div id="hint">TAP / CLICK TO RESTART</div>

<script>
/* ================= BASIC ================= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize",resize);
resize();

/* ================= CONSTANT ================= */
const TILE = 48;
const SPEED = 6;
const GRAVITY = 0.9;
const JUMP = -15;

/* ================= GROUND ================= */
let GROUND_Y = canvas.height - TILE*2;

/* ================= ASSETS ================= */
const img = {};
["cube","spike","block","orb_yellow","pad_yellow","bg"].forEach(n=>{
  img[n]=new Image();
  img[n].src = n+".png";
});

const music = new Audio("music.mp3");
music.loop = false;
const sJump = new Audio("jump.wav");
const sDeath = new Audio("death.wav");

/* ================= PLAYER ================= */
let player,offset,dead,progress;

function reset(){
  GROUND_Y = canvas.height - TILE*2;
  player = {
    x: 200,
    y: GROUND_Y - TILE,
    vy: 0,
    size: TILE,
    rot: 0,
    onGround: false
  };
  offset = 0;
  dead = false;
  progress = 0;
  music.currentTime = 0;
  music.play();
}
reset();

/* ================= MAP (FIXED) ================= */
const map = [
  {x:600, t:"spike"},
  {x:900, t:"spike"},
  {x:1200, t:"block"},
  {x:1500, t:"spike"},
  {x:1800, t:"pad"},
  {x:2100, t:"spike"},
  {x:2500, t:"orb"},
  {x:3000, t:"spike"},
  {x:3500, t:"block"},
  {x:4000, t:"spike"},
  {x:4600, t:"pad"},
  {x:5200, t:"spike"},
  {x:6000, t:"orb"},
  {x:7000, t:"spike"},
  {x:8200, t:"block"},
  {x:9500, t:"spike"},
  {x:11000, t:"spike"}
];
const MAP_END = 12000;

/* ================= INPUT ================= */
function jump(){
  if(dead){ reset(); return; }
  if(player.onGround){
    player.vy = JUMP;
    player.onGround = false;
    sJump.currentTime = 0;
    sJump.play();
  }
}
addEventListener("mousedown",jump);
addEventListener("touchstart",e=>{e.preventDefault();jump();});

/* ================= LOOP ================= */
function loop(){
  requestAnimationFrame(loop);
  ctx.clearRect(0,0,canvas.width,canvas.height);

  /* BG */
  ctx.drawImage(img.bg,0,0,canvas.width,canvas.height);

  if(dead) return;

  offset += SPEED;
  progress = Math.min(100,Math.floor(offset/MAP_END*100));
  document.getElementById("ui").innerText = progress + "%";

  /* PHYSICS */
  player.vy += GRAVITY;
  player.y += player.vy;

  if(player.y + TILE >= GROUND_Y){
    player.y = GROUND_Y - TILE;
    player.vy = 0;
    player.onGround = true;
  }

  player.rot += 0.12;

  /* DRAW MAP */
  for(const o of map){
    const x = o.x - offset + player.x;
    if(x < -100 || x > canvas.width+100) continue;

    if(o.t==="block"){
      ctx.drawImage(img.block, x, GROUND_Y-TILE, TILE, TILE);
      if(hit(x,GROUND_Y-TILE,TILE,TILE)) die();
    }

    if(o.t==="spike"){
      ctx.drawImage(img.spike, x, GROUND_Y-TILE, TILE, TILE);
      if(hit(x,GROUND_Y-TILE,TILE,TILE)) die();
    }

    if(o.t==="pad"){
      ctx.drawImage(img.pad_yellow, x, GROUND_Y-TILE/2, TILE, TILE/2);
      if(hit(x,GROUND_Y-TILE/2,TILE,TILE/2)){
        player.vy = JUMP*1.3;
      }
    }

    if(o.t==="orb"){
      ctx.drawImage(img.orb_yellow, x+8, GROUND_Y-TILE*2, 32, 32);
      if(hit(x+8,GROUND_Y-TILE*2,32,32) && !player.onGround){
        player.vy = JUMP*1.2;
      }
    }
  }

  /* PLAYER + GLOW */
  ctx.save();
  ctx.translate(player.x+TILE/2, player.y+TILE/2);
  ctx.rotate(player.rot);
  ctx.shadowColor="#0ff";
  ctx.shadowBlur=20;
  ctx.drawImage(img.cube,-TILE/2,-TILE/2,TILE,TILE);
  ctx.restore();
}
loop();

/* ================= COLLISION ================= */
function hit(x,y,w,h){
  return player.x < x+w &&
         player.x+TILE > x &&
         player.y < y+h &&
         player.y+TILE > y;
}
function die(){
  if(dead) return;
  dead = true;
  music.pause();
  sDeath.play();
}
</script>
</body>
</html>
