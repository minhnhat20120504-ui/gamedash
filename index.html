<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Geometry Dash LGBT</title>

<style>
html,body{
  margin:0;
  padding:0;
  background:#000;
  overflow:hidden;
  touch-action:none;
  font-family:Arial,Helvetica,sans-serif;
}
canvas{display:block}
#ui{
  position:fixed;
  top:10px;
  left:50%;
  transform:translateX(-50%);
  color:#fff;
  font-size:18px;
  text-shadow:0 0 10px #f0f;
}
#hint{
  position:fixed;
  bottom:15px;
  left:50%;
  transform:translateX(-50%);
  color:#aaa;
  font-size:12px;
}
#menu{
  position:fixed;
  inset:0;
  background:#000;
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.level{
  border:2px solid #0ff;
  padding:12px 40px;
  margin:10px;
  cursor:pointer;
  text-shadow:0 0 8px #0ff;
}
.level.devil{
  border-color:#f00;
  color:#f55;
  text-shadow:0 0 10px #f00;
}
.level:hover{background:#022}
</style>
</head>

<body>

<canvas id="c"></canvas>
<div id="ui">0%</div>
<div id="hint">TAP / LEFT CLICK TO JUMP</div>

<div id="menu">
  <h2>SELECT LEVEL</h2>
  <div class="level" onclick="startLevel(0)">Level cho chÃ³ chÆ¡i</div>
  <div class="level devil" onclick="startLevel(2)">ðŸ˜ˆ DEVIL MODE</div>
</div>

<script>
/* ================= BASIC ================= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
function resize(){
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener("resize",resize);
resize();

/* ================= CONSTANT ================= */
const TILE = 48;
const SPEED = 6;
const GRAVITY = 0.9;
const JUMP = -15;

/* ================= ASSETS ================= */
const img = {};
["cube","spike","block","orb_yellow","pad_yellow","bg"].forEach(n=>{
  img[n]=new Image();
  img[n].src=n+".png";
});
const sJump=new Audio("jump.wav");
const sDeath=new Audio("death.wav");
const music=new Audio();

/* ================= LEVEL DATA ================= */
const LEVELS=[
{
  name:"Stereo Madness",
  music:"music1.mp3",
  length:12000,
  map:[
    {x:600,t:"spike"},
    {x:900,t:"spike"},
    {x:1200,t:"block"},
    {x:1600,t:"pad"},
    {x:2100,t:"spike"},
    {x:2600,t:"orb"},
    {x:3200,t:"spike"},
    {x:3800,t:"block"},
    {x:4500,t:"spike"},
  ]
},
{
  name:"Back on Track",
  music:"music2.mp3",
  length:14000,
  map:[
    {x:700,t:"block"},
    {x:1000,t:"spike"},
    {x:1400,t:"spike"},
    {x:1800,t:"pad"},
    {x:2300,t:"orb"},
    {x:3000,t:"spike"},
    {x:3600,t:"block"},
    {x:4200,t:"spike"},
  ]
},
{
  name:"DEVIL MODE",
  music:"music_devil.mp3",
  length:18000,
  map:[
    {x:500,t:"spike"},
    {x:800,t:"spike"},
    {x:1200,t:"spike"},
    {x:1400,t:"pad"},
    {x:1800,t:"spike"},
    {x:1950,t:"spike"},
    {x:2100,t:"orb"},
    {x:2200,t:"spike"},
    {x:2450,t:"spike"},
    {x:2900,t:"pad"},
    {x:2500,t:"orb"},
    {x:2800,t:"spike"},
    {x:3350,t:"spike"},
    {x:3700,t:"spike"},
    {x:3900,t:"pad"},
    {x:3100,t:"orb"},
    {x:3300,t:"spike"},
    {x:3450,t:"spike"},
    {x:3600,t:"spike"},
    {x:3800,t:"pad"},
    {x:4000,t:"orb"},
    {x:4200,t:"spike"},
    {x:4350,t:"spike"},
    {x:4500,t:"spike"},
    {x:4800,t:"pad"},
    {x:5000,t:"orb"},
    {x:5200,t:"spike"},
    {x:5350,t:"spike"},
    {x:5500,t:"spike"},
    {x:5800,t:"pad"},
    {x:6000,t:"orb"},
    {x:6200,t:"spike"},
    {x:6350,t:"spike"},
    {x:6500,t:"spike"},
  ]
}
];

let GROUND_Y,player,offset,dead,progress;
let map=[],MAP_END=0;

/* ================= START LEVEL ================= */
function startLevel(i){
  document.getElementById("menu").style.display="none";
  const L=LEVELS[i];
  map=L.map;
  MAP_END=L.length;
  music.src=L.music;
  music.currentTime=0;
  music.play();
  reset();
}

/* ================= RESET ================= */
function reset(){
  GROUND_Y=canvas.height-TILE*2;
  player={
    x:200,
    y:GROUND_Y-TILE,
    vy:0,
    rot:0,
    onGround:false
  };
  offset=0;
  dead=false;
  progress=0;
}

/* ================= INPUT ================= */
function jump(){
  if(dead){ reset(); music.play(); return; }
  if(player.onGround){
    player.vy=JUMP;
    player.onGround=false;
    sJump.currentTime=0;
    sJump.play();
  }
}
addEventListener("mousedown",jump);
addEventListener("touchstart",e=>{e.preventDefault();jump();});

/* ================= LOOP ================= */
function loop(){
  requestAnimationFrame(loop);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(img.bg,0,0,canvas.width,canvas.height);
  if(dead) return;

  offset+=SPEED;
  progress=Math.min(100,Math.floor(offset/MAP_END*100));
  document.getElementById("ui").innerText=progress+"%";

  player.vy+=GRAVITY;
  player.y+=player.vy;
  if(player.y+TILE>=GROUND_Y){
    player.y=GROUND_Y-TILE;
    player.vy=0;
    player.onGround=true;
  }
  player.rot+=0.15;

  for(const o of map){
    const x=o.x-offset+player.x;
    if(x<-100||x>canvas.width+100) continue;

    if(o.t==="block"){
      ctx.drawImage(img.block,x,GROUND_Y-TILE,TILE,TILE);
      if(hit(x,GROUND_Y-TILE,TILE,TILE)) die();
    }
    if(o.t==="spike"){
      ctx.drawImage(img.spike,x,GROUND_Y-TILE,TILE,TILE);
      if(hit(x,GROUND_Y-TILE,TILE,TILE)) die();
    }
    if(o.t==="pad"){
      ctx.drawImage(img.pad_yellow,x,GROUND_Y-TILE/2,TILE,TILE/2);
      if(hit(x,GROUND_Y-TILE/2,TILE,TILE/2)){
        player.vy=JUMP*1.35;
      }
    }
    if(o.t==="orb"){
      ctx.drawImage(img.orb_yellow,x+8,GROUND_Y-TILE*2,32,32);
      if(hit(x+8,GROUND_Y-TILE*2,32,32)&&!player.onGround){
        player.vy=JUMP*1.25;
      }
    }
  }

  ctx.save();
  ctx.translate(player.x+TILE/2,player.y+TILE/2);
  ctx.rotate(player.rot);
  ctx.shadowColor="#f0f";
  ctx.shadowBlur=25;
  ctx.drawImage(img.cube,-TILE/2,-TILE/2,TILE,TILE);
  ctx.restore();
}
loop();

/* ================= COLLISION ================= */
function hit(x,y,w,h){
  return player.x<x+w&&player.x+TILE>x&&player.y<y+h&&player.y+TILE>y;
}
function die(){
  if(dead) return;
  dead=true;
  music.pause();
  sDeath.play();
}
</script>
</body>
</html>
